<%- include('header') -%>

<div class="launch-portal-container">
  <img
    class="rounded mx-auto d-block"
    src="images/launch.png"
    id="launch-button"
    onclick="startLaunch()"
    alt="Launch Now"
    width="40%"
    style="cursor: pointer"
  />
  <div id="fireworks-container" class="fireworks"></div>

  <!-- Full-sized overlay for the video -->
  <div
    id="video-overlay"
    style="
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: black;
      z-index: 100;
    "
  >
    <video
      id="launch-video"
      width="640"
      height="360"
      controls
      style="width: 100%; height: 100%"
    >
      <source src="videos/launch.mp4" type="video/mp4" />
      Your browser does not support the video tag.
    </video>
  </div>
</div>

<script>
  async function startLaunch() {

    // Wait for 3 seconds
    await new Promise(resolve => setTimeout(resolve, 1000));

    const launchButton = document.getElementById("launch-button");
    const videoOverlay = document.getElementById("video-overlay");
    const videoElement = document.getElementById("launch-video");

    try {
        const response = await fetch("/toggle-maintenance", { method: "POST" });

        if (response.ok) {
            const result = await response.json();
            console.log("Maintenance mode toggled:", result.isUnderMaintenance);
        } else {
            console.error("Failed to toggle maintenance mode:", response.statusText);
        }
    } catch (error) {
        console.error("Error toggling maintenance mode:", error.message);
    }

    launchButton.disabled = true;

    // Display the video overlay
    videoOverlay.style.display = "block";


    // Request fullscreen for the video overlay
    if (videoOverlay.requestFullscreen) {
        videoOverlay.requestFullscreen();
    } else if (videoOverlay.mozRequestFullScreen) {
        videoOverlay.mozRequestFullScreen();
    } else if (videoOverlay.webkitRequestFullscreen) {
        videoOverlay.webkitRequestFullscreen();
    } else if (videoOverlay.msRequestFullscreen) {
        videoOverlay.msRequestFullscreen();
    }

    // Play the video programmatically
    videoElement.play();

    // Hide video controls
    videoElement.controls = false;

    // Wait for the video to end
    await new Promise(resolve => {
        videoElement.onended = resolve;
    });

    // Exit fullscreen
    if (document.exitFullscreen) {
        document.exitFullscreen();
    } else if (document.mozCancelFullScreen) {
        document.mozCancelFullScreen();
    } else if (document.webkitExitFullscreen) {
        document.webkitExitFullscreen();
    } else if (document.msExitFullscreen) {
        document.msExitFullscreen();
    }

    // Hide the video overlay
    videoOverlay.style.display = "none";

    // Enable the launch button
    launchButton.disabled = false;

    // Redirect to the main page
    window.location.href = '/';
}


</script>

<%- include('footer') -%>
